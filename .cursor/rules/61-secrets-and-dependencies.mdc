---
description: "Secrets handling and dependency/supply-chain rules for L9."
globs:
  - "**/package.json"
  - "**/package-lock.json"
  - "**/requirements*.txt"
  - "**/pyproject.toml"
  - "**/*.env*"
  - ".env.example"
  - ".github/workflows/**"
alwaysApply: false
---

# Secrets and dependencies (L9)

## Secrets management

- **No secrets in code or VCS**:
  - Do not commit API keys, tokens, passwords, or private keys into source files, configs, or test data.
  - Treat any accidental secret commit as an incident: rotate the secret and scrub it from history where feasible.
- **Use environment variables / secret stores**:
  - Secrets must be provided via environment variables or a managed secret store, not hard-coded.
  - `.env.example` must contain **all required keys** with placeholder values and comments, never real secrets.
- **Patterns to avoid**:
  - Strings that look like keys/tokens (long random base64/hex, vendor-specific prefixes) in tracked files.
  - In CI YAML, use `${{ secrets.* }}` (or equivalent) instead of hardcoded values.

---

## Dependency and supply-chain policy

- **Pin or constrain versions**:
  - `package.json` and `requirements`/`pyproject.toml` should avoid loose `latest` or unconstrained ranges for critical libraries.
  - Prefer caret/tilde ranges or explicit pins with an upgrade policy.
- **Upgrade discipline**:
  - Group dependency upgrades into focused PRs with clear changelog links and tests.
  - For major upgrades, require additional regression tests or targeted checks.
- **Security and SCA checks**:
  - CI pipelines touching dependency manifests must run at least one security/sca step (e.g., `npm audit`, `pip-audit`, or an equivalent scanner).
  - Failing high/critical issues must be triaged (fix, ignore with justification, or mitigate) before merge.

---

## CI workflow expectations

- CI workflows that build or deploy must:
  - Consume secrets from the platformâ€™s secret store, **never** from committed files.
  - Include steps to install dependencies in a reproducible way (lockfiles where applicable).
  - Optionally include periodic dependency health checks (outdated reports, audit summaries).

---
