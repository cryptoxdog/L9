---
description: "GMP v1.7 action workflow: enforce Phases 0–6, quick actions, and corrective runs for L9 repo changes."
alwaysApply: true
---

# GMP v1.7 execution rules (L9)

## Phase discipline (0–6)

- Every significant change must follow **GMP Phases 0–6** from GMP-System / Action prompts: Phase 0 (PLAN), 1 (BASELINE), 2 (IMPLEMENT), 3 (ENFORCE), 4 (VALIDATE), 5 (RECURSIVE VERIFY), 6 (FINALIZE).
- For each Cursor task, **state current phase in the prompt** and keep scope aligned with that phase.
- Do not jump directly to Phase 2; always lock a **Phase 0 TODO plan** with file paths, actions, and expected behavior.

❌ **DON'T:**
> “Refactor executor and websocket orchestrator to be cleaner.”

✅ **DO:**
> “Phase 0. Lock TODO plan for `l9/executor.py` and `l9/task_queue.py`: Insert timeout handling and explicit error packets, no API changes.”

---

## Quick actions vs full runs

- Use **GMP_QUICK_ACTIONS** patterns only for **small, low-risk edits** (one file, no behavior change).
- Any change touching **kernels, executor, tool registry, memory substrate, or deployment manifests** must use the **full GMP v1.7 action prompt** flow.
- When using quick actions, explicitly say: `Scope: QUICK_ACTION; No changes to behavior, tests must still pass.`

---

## Corrective runs

- If a previous change caused regressions, initiate a **CORRECTIVE RUN** using the corrective GMP template.
- Explicitly reference the failing behavior and link it to the prior Phase 0 plan in the prompt.
- Corrective runs must:
  - Identify root cause.
  - Amend TODO plan.
  - Add/strengthen regression tests called out in the corrective template.

---

## GMP block structure (Cursor prompts)

- For multi-file work, structure prompts as **GMP blocks**:
  - `PHASE`: current phase (0–6).
  - `SCOPE`: file list and allowed actions (insert/replace/wrap/delete).
  - `CONSTRAINTS`: invariants from STRICT_MODE and L9 global rules.
  - `TESTS`: required checks (unit, integration, critical-path) derived from GMP Action test prompts.
- Never ask Cursor to “do everything”; keep prompts small, single‑objective, and fully aligned with the declared phase.

---

## Phase closure conditions

- A phase is complete only when its **GMP closure conditions** are met (e.g., Phase 4 requires all tests defined in the Action+Tests prompts to pass).
- Do not advance to Phase 6 until:
  - Phase 4 tests (unit + integration + critical-path where applicable) are green.
  - Phase 5 recursive comparison confirms no scope drift vs Phase 0.
- Finalization requires a **signed evidence summary** in commit message or PR description that maps back to phases and test sets.

---

## Testing references

- Phase closure conditions in this file **depend on** the detailed testing rules in `50-qa-testing.mdc`.
- When a phase requires tests to be green (e.g., Phase 4), apply the policies and patterns defined in `50-qa-testing.mdc` (unit, integration, critical-path, performance).
