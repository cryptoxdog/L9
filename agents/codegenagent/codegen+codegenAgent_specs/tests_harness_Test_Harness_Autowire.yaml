# ============================================================
# PATCH â€” Test_Harness_Autowire.py
# Purpose: Dynamic slot expansion based on schema slots and tags
# ============================================================

filename: tests/harness/Test_Harness_Autowire.py
patch_type: smart_test_scaffold
language: python
description: |
  Improves the generated tests by mapping construct schema slots
  to individual test cases using slot tags, memory traces, and
  prompt features.

patch:
  update_function: autowire_tests
  recursive_enrichment_passes: 3
  enriched_code: |
    def autowire_tests():
        module_schemas = [f for f in os.listdir('schemas/modules/') if f.endswith('.yaml')]
        for schema_file in module_schemas:
            with open(f'schemas/modules/{schema_file}') as f:
                schema = yaml.safe_load(f)

            test_code = emit_tests_from_schema(schema)

            for slot in schema.get("slots", []):
                if slot.get("type") == "tensor":
                    test_code += f"\n# Test tensor slot: {slot['name']}"
                if "prompt_trace" in slot:
                    test_code += f"\n# Verify prompt trace for {slot['name']}"

            with open(f'tests/generated/test_{schema["name"]}.py', 'w') as f:
                f.write(test_code)