# ============================================================
# AutoLinter_Injector.py
# ============================================================

filename: runtime/patch/AutoLinter_Injector.py
type: construct_runtime_tool
language: python
description: |
  Automatically injects linting policies and CI checks into any
  construct emitted by CGA. Reads construct_features to determine
  which policies to enforce. Emits annotated linter file + CI status.

wiring:
  inputs:
    - path: agents/generated/*.py
    - schema: construct_features.enable_auto_linter = true
  outputs:
    - path: audit/linter_results/*.json
    - path: agents/linter_policy_injected/*.py
  triggers:
    - construct_emitted
    - manual_lint_flag

code: |
  import os, json
  from utils.linter import run_linter, inject_policy_annotations

  def lint_constructs():
      src_folder = 'agents/generated/'
      dst_folder = 'agents/linter_policy_injected/'
      os.makedirs(dst_folder, exist_ok=True)

      for file in os.listdir(src_folder):
          if file.endswith('.py'):
              path = os.path.join(src_folder, file)
              lint_result = run_linter(path)
              annotated = inject_policy_annotations(path, lint_result)

              with open(os.path.join(dst_folder, file), 'w') as f:
                  f.write(annotated)
              with open(f'audit/linter_results/{file}.json', 'w') as r:
                  json.dump(lint_result, r)

  if __name__ == "__main__":
      lint_constructs()
# ============================================================================
# L9 DORA BLOCK - AUTO-GENERATED - DO NOT EDIT
# ============================================================================
l9_dora:
  component_id: "AGE-INTE-098"
  component_name: "Runtime Patch Autolinter Injector"
  module_version: "1.0.0"
  created_at: "2026-01-08T03:17:26Z"
  created_by: "L9_DORA_Injector"
  layer: "intelligence"
  domain: "agent_execution"
  type: "config"
  status: "active"
  governance_level: "critical"
  compliance_required: true
  audit_trail: true
  purpose: "Configuration file for runtime patch AutoLinter Injector"
  dependencies: []
# ============================================================================
# END L9 DORA BLOCK
# ============================================================================
