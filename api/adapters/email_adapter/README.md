# Email Adapter

> Receives inbound emails via webhook, parses content, and routes to AIOS for processing. Supports Gmail API integration.

**Module ID:** `email.adapter`  
**Tier:** 1  
**Spec Version:** 2.6.0  
**Spec Hash:** `SPEC-62d9295fc71f`  
**Generated:** 2025-12-18T06:24:54.974886+00:00

---

## Overview

This module was auto-generated from `Module-Spec-v2.6-email_adapter.yaml`.

### Responsibilities

- Receives inbound emails via webhook, parses content, and routes to AIOS for processing. Supports Gmail API integration.
- Integrate with L9 memory substrate
- Emit standardized packets (email_adapter.*)

### Non-Goals

- No new database tables
- No new migrations
- No parallel memory/logging systems

---

## API Endpoints

### Inbound

| Endpoint | Method | Auth |
|----------|--------|------|
| `/email/webhook` | POST | bearer |


### Outbound Dependencies

| Service | Endpoint | Timeout |
|---------|----------|--------|
| aios_runtime_call | `/chat` | 30s |
| memory_service_call | `/memory/ingest` | 30s |
| gmail_users_messages_get | `https://api.gmail.com/...` | 10s |
| gmail_users_messages_send | `https://api.gmail.com/...` | 10s |


---

## Packet Contract

This module emits the following packet types:

| Packet Type | Trigger |
|------------|---------|
| `email_adapter.in` | On valid request received |
| `email_adapter.out` | On successful processing |
| `email_adapter.error` | On error |

---

## Idempotency

- **Pattern:** `event_id`
- **Source:** `platform_event_id`
- **Behavior:** Duplicate requests return cached response without re-processing

---

## Configuration

Required environment variables:

| Variable | Description |
|----------|-------------|
| `EMAIL_ADAPTER_SIGNING_SECRET` | Required |
| `GMAIL_API_KEY` | Required |

Optional:

| `EMAIL_ADAPTER_ENABLED` | Optional |
| `EMAIL_ADAPTER_LOG_LEVEL` | Optional |

---

## Testing

### Run Tests

```bash
pytest tests/ -v
```

### Acceptance Criteria

**Positive:**
- [ ] valid_email_processed
- [ ] idempotent_replay_cached
- [ ] email_parsed_correctly
- [ ] aios_response_forwarded
- [ ] packet_written_on_success
- [ ] attachment_handling

**Negative:**
- [ ] invalid_auth_rejected
- [ ] duplicate_event_deduped

---

## File Structure

```
email_adapter/
├── README.md              # This file
├── __init__.py            # Package init
├── config.py              # Configuration
├── schemas.py             # Pydantic schemas
├── adapters/
│   └── email_adapter_adapter.py
├── routes/
│   └── email_adapter.py
├── clients/
│   └── email_adapter_client.py
├── services/
│   └── email_adapter_service.py
└── tests/
    ├── conftest.py
    ├── test_email_adapter.py
    └── test_email_adapter_integration.py
```

---

*Auto-generated by L9 Module Pipeline v2.0*

---

<!-- Generated from Module-Spec v2.6 -->
<!-- module_id: email.adapter -->
<!-- enforced_acceptance: ['valid_email_processed', 'idempotent_replay_cached', 'email_parsed_correctly', 'aios_response_forwarded', 'packet_written_on_success', 'attachment_handling', 'invalid_auth_rejected', 'duplicate_event_deduped'] -->

<!-- DORA META BLOCK — DO NOT EDIT MANUALLY (CI-owned) -->
<!--
meta:
  template_version: "2.6.0"
  spec_hash: "SPEC-62d9295fc71f"
  created_at: "2025-12-18T06:24:54.974886+00:00"
  created_by: module_pipeline
  last_updated_at: "2025-12-18T06:24:54.974886+00:00"
  last_updated_by: module_pipeline
  module_id: "email.adapter"
  file: "README.md"
-->
