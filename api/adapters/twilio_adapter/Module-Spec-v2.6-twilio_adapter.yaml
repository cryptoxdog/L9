schema_version: 2.6.0
meta:
  schema_version: 2.6.0
  template_version: 2.6.0
  created_at: '2025-12-18T06:25:01.428973+00:00'
  created_by: spec_compiler
  last_updated_at: '2025-12-18T06:25:01.511822+00:00'
  last_updated_by: policy_applier
  last_commit_sha: SPEC-102d1d3dc34c
  finalized_at: '2025-12-18T06:25:01.511822+00:00'
  finalized_by: policy_applier
metadata:
  module_id: twilio.adapter
  name: Twilio Adapter
  tier: 1
  description: Receives Twilio SMS/voice webhooks, validates signatures, and routes
    to AIOS for processing. Supports outbound messaging via Twilio API.
  system: L9
  language: python
  runtime: python>=3.11
ownership:
  team: integrations
  primary_contact: integrations_lead
runtime_wiring:
  service: api
  startup_phase: normal
  depends_on:
  - postgres
  - memory.service
  blocks_startup_on_failure: false
  placement: fastapi_route_handler
runtime_contract:
  runtime_class: control_plane
  execution_model: request_driven
external_surface:
  exposes_http_endpoint: true
  exposes_webhook: true
  exposes_tool: false
  callable_from:
  - external
  - internal
dependency_contract:
  inbound:
  - from_module: external
    interface: http
    endpoint: /twilio/webhook
  outbound:
  - to_module: aios.runtime
    interface: http
    endpoint: /chat
  - to_module: memory.service
    interface: http
    endpoint: /memory/ingest
  - to_module: external
    interface: http
    endpoint: twilio.messages.create
  - to_module: external
    interface: http
    endpoint: twilio.calls.create
dependencies:
  allowed_tiers:
  - 0
  - 1
  outbound_calls:
  - module: aios.runtime
    interface: http
    endpoint: /chat
  - module: memory.service
    interface: http
    endpoint: /memory/ingest
packet_contract:
  emits:
  - twilio_adapter.in
  - twilio_adapter.out
  - twilio_adapter.error
  requires_metadata:
  - task_id
  - thread_uuid
  - source
  - tool_id
packet_expectations:
  on_success:
    emits:
    - twilio_adapter.out
  on_error:
    emits:
    - twilio_adapter.error
  durability:
    success: durable
    error: durable
idempotency:
  pattern: event_id
  source: message_sid
  durability: none
  check_method: substrate_search
  cache_ttl_seconds: 86400
  dedupe_behavior: return_cached_response
threading:
  strategy: deterministic_uuidv5
  thread_key_fields:
  - from_number
  - to_number
  - account_sid
  namespace: 6ba7b810-9dad-11d1-80b4-00c04fd430c8
error_policy:
  default: best_effort
  retries:
    enabled: false
    max_attempts: 0
  categories:
    invalid_signature:
      status: 401
      action: reject
    stale_timestamp:
      status: 401
      action: reject
    aios_failure:
      status: 200
      action: log_and_continue
    side_effect_failure:
      status: 200
      action: log_and_continue
    storage_failure:
      status: 200
      action: log_and_continue
observability:
  logs:
    enabled: true
    level: info
  metrics:
    enabled: true
  traces:
    enabled: true
runtime_touchpoints:
  touches_db: true
  touches_tools: true
  touches_external_network: true
  affects_boot: false
tier_expectations:
  requires_runtime_wiring: true
  requires_packet_contract: true
  requires_negative_tests: false
test_scope:
  unit: true
  integration: true
  docker_smoke: true
acceptance:
  positive:
  - valid_sms_processed
  - idempotent_replay_cached
  - signature_validated
  - aios_response_forwarded
  - packet_written_on_success
  - outbound_sms_sent
  negative:
  - invalid_signature_rejected
  - duplicate_message_deduped
global_invariants_ack:
  emits_packet_on_ingress: true
  unknown_tool_id_hard_fail: true
spec_confidence:
  level: high
repo:
  root_path: L9
  allowed_new_files:
  - api/adapters/twilio_adapter_adapter.py
  - api/routes/twilio_adapter.py
  - api/clients/twilio_adapter_client.py
  - tests/test_twilio_adapter.py
  - docs/twilio_adapter.md
  allowed_modified_files:
  - api/server.py
interfaces:
  inbound:
  - name: twilio_adapter_endpoint
    method: POST
    route: /twilio/webhook
    auth: hmac-sha256
    payload_type: JSON
  outbound:
  - name: aios_runtime_call
    endpoint: /chat
    method: POST
    timeout_seconds: 30
    retry: false
  - name: memory_service_call
    endpoint: /memory/ingest
    method: POST
    timeout_seconds: 30
    retry: false
  - name: twilio_messages_create
    endpoint: https://api.twilio.com/...
    method: POST
    timeout_seconds: 10
    retry: true
  - name: twilio_calls_create
    endpoint: https://api.twilio.com/...
    method: POST
    timeout_seconds: 10
    retry: true
environment:
  required:
  - TWILIO_ACCOUNT_SID
  - TWILIO_AUTH_TOKEN
  - TWILIO_PHONE_NUMBER
  optional:
  - TWILIO_ADAPTER_ENABLED
  - TWILIO_ADAPTER_LOG_LEVEL
orchestration:
  validation:
  - verify_signature
  - check_timestamp_freshness
  - parse_and_validate_payload
  context_reads:
  - search_conversation_history
  side_effects:
  - write_inbound_packet
  - write_outbound_packet
  - send_external_response
boot_impact:
  level: soft
standards:
  logging:
    library: structlog
  http_client:
    library: httpx
goals:
- Receives Twilio SMS/voice webhooks, validates signatures, and routes to AIOS for
  processing. Supports outbound messaging via Twilio API.
- Integrate with L9 memory substrate
- Emit standardized packets (twilio_adapter.*)
non_goals:
- No new database tables
- No new migrations
- No parallel memory/logging systems
notes_for_generators:
- 'Module tier: 1 (Integrations + Mac Extensions)'
- 'Placement: fastapi_route_handler'
- 'Idempotency: event_id (none)'
- Policy rules applied at 2025-12-18T06:25:01.511822+00:00
- 'Spec finalized with hash: SPEC-102d1d3dc34c'
codegen_hints:
  completeness_target: 0.8
  allow_real_logic: true
  allow_real_tests: true
  stub_strategy: production_scaffold
  forbid_guessing: true
  refuse_if_missing:
  - runtime_wiring
  - dependency_contract
  - packet_contract
  - acceptance
delivery_metrics:
  track:
  - lead_time
  - change_frequency
  - change_failure_rate
  - recovery_time
  ownership:
    primary: integrations
    escalation: integrations_lead
  enforcement:
    human_editing_forbidden: true
    ci_owned: true
maturity:
  stage: beta
  production_ready: false
escalation_policy:
  on_repeated_failure:
    threshold: 3
    window: 24h
    escalate_to: integrations_lead
# ============================================================================
# L9 DORA BLOCK - AUTO-GENERATED - DO NOT EDIT
# ============================================================================
l9_dora:
  component_id: "API-OPER-003"
  component_name: "Module Spec V2.6 Twilio Adapter"
  module_version: "1.0.0"
  created_at: "2026-01-08T03:17:26Z"
  created_by: "L9_DORA_Injector"
  layer: "operations"
  domain: "api_gateway"
  type: "config"
  status: "active"
  governance_level: "medium"
  compliance_required: true
  audit_trail: true
  purpose: "Configuration file for Module Spec v2.6 twilio adapter"
  dependencies: []
# ============================================================================
# END L9 DORA BLOCK
# ============================================================================
