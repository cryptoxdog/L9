## Root README template (`/README.meta.yaml`)

```yaml
location: "/"  # Path where the rendered README.md should live

type: root_readme  # Identifies this as the main repository README

project:
  name: "L9 Secure AI OS"  # Human-readable project name
  one_liner: "Secure agent OS with tools, memory, and governance."  # Single-sentence summary
  goals:  # High-level goals; what success looks like
    - "Provide a secure, governed agent runtime."
    - "Support tools, memory, and long plans for L."
  non_goals:  # Explicitly out-of-scope items
    - "General-purpose web framework."
    - "Unrestricted code execution."

architecture:
  summary: "High-level architecture description in 2–4 sentences."  # Short narrative overview
  key_components:  # Core subsystems exposed in this repo
    - id: "api"
      path: "l9/server.py"
      role: "External API surface and routing."
    - id: "agents"
      path: "l9/core/agents/"
      role: "Agent configs, registry, and execution logic."
    - id: "memory"
      path: "l9/core/memory/"
      role: "Memory substrate and retrieval helpers."

repository_layout:
  entries:  # Top-level directories and what lives in each
    - path: "l9/"
      description: "Core runtime for L9 OS (APIs, agents, tools, memory)."
    - path: "docs/"
      description: "Architecture, governance, and operational documentation."
    - path: "scripts/"
      description: "Helper scripts for dev, ops, and maintenance."

getting_started:
  prerequisites:  # Tooling and services needed to run locally
    - "Python 3.11+"
    - "PostgreSQL 14+"
    - "Redis 7+"
    - "Docker + docker-compose"
  setup_steps:  # Ordered steps to get a dev environment running
    - "Clone the repo and create a virtualenv."
    - "Install dependencies from requirements.txt."
    - "Copy .env.example to .env and fill values."
  quickstart_commands:  # Concrete commands for a first run
    - "docker-compose up -d"
    - "uvicorn l9.server:app --reload"

configuration:
  files:  # Config files and their roles
    - path: "config.yaml"
      purpose: "Global configuration for runtime and services."
    - path: ".env"
      purpose: "Environment-specific secrets and overrides."
  env_vars_required:  # Critical environment variables that must be set
    - "OPENAI_API_KEY"
    - "DATABASE_URL"
    - "REDIS_URL"

testing:
  commands:  # How to run tests and quality gates
    - "pytest"
    - "ruff check ."
    - "mypy l9/"
  notes: "Describe any required services (DB/Redis) to run tests."  # Extra info for tests

deployment:
  strategy: "Describe how this repo is deployed (CI, VPS, containers)."  # Summary of deployment model
  entrypoints:  # Commands/entrypoints used in production
    - "gunicorn l9.server:app -k uvicorn.workers.UvicornWorker"
  environments:  # Per-environment notes
    - name: "production"
      notes: "Managed by docker-compose on VPS behind Caddy."

observability:
  logging: "Conventions for log format, levels, and sinks."  # How logging works
  metrics: "Where metrics are emitted and how to view them."  # Metrics/tracing details
  dashboards:  # Links or references to ops dashboards (if any)
    - "grafana://l9/core"

security:
  threat_model_summary: "High-level summary of what is protected and against whom."  # Threat model overview
  sensitive_components:  # Parts of the codebase that must be handled carefully
    - "auth and token handling"
    - "tool execution surfaces"
  data_policies: "Notes on PII handling, encryption, and retention."  # Data handling guidelines

ai_collaboration:
  allowed_scopes:  # Where AI tools may edit code
    - "application logic under l9/core/"
  restricted_scopes:  # Where changes need explicit human review
    - "infra (docker-compose, Caddy, authentication, kernels)"
  forbidden_scopes:  # Where AI must not edit
    - "secrets, private keys, production configuration"
  required_pre_reading:  # Docs AI must read before editing
    - "docs/architecture.md"
    - "docs/ai-collaboration.md"
  change_policy: "AI changes must be delivered as scoped PRs with tests and docs updated."  # High-level rule

contribution:
  workflow: "Describe branching, PR, and review process."  # Contribution model
  coding_standards:  # Style and linting rules
    - "PEP8 via ruff"
    - "Type hints via mypy"
  contact: "How to reach maintainers or Igor for approvals."  # Escalation path

license:
  type: "MIT"  # License identifier
  file: "LICENSE"  # Path to license file
```


***

## Subsystem README template (`l9/<subsystem>/README.meta.yaml`)

Use for subsystem folders like `l9/core/agents/`, `l9/core/memory/`, `l9/api/`.[^1]

```yaml
location: "l9/core/agents/"  # Directory this README describes

type: subsystem_readme  # Identifies this as a subsystem-level README

subsystem:
  name: "Agents Core"  # Human name for this subsystem
  purpose: "Define, register, and execute agents (L, CA, Critic)."  # What this subsystem does
  context: "Called by API and orchestrator to run agent tasks."  # How it fits into the larger system

responsibilities:
  handles:  # Things this subsystem is responsible for
    - "Loading agent configs and kernels."
    - "Instantiating AgentInstance objects."
    - "Coordinating agent execution via Executor."
  avoids:  # Things this subsystem must not do
    - "Direct HTTP handling."
    - "Direct DB or Redis access outside memory substrate."

directory_layout:
  entries:  # Important files/subfolders and their roles
    - path: "__init__.py"
      role: "Package initializer; keeps imports lightweight."
    - path: "registry.py"
      role: "AgentRegistry implementation and agent lookup."
    - path: "agentinstance.py"
      role: "Agent runtime state and message shaping."
    - path: "engine.py"
      role: "Execution engine logic for agents."

key_components:
  public_apis:  # Intended entrypoints used by other subsystems
    - name: "AgentRegistry"
      path: "l9/core/agents/registry.py"
      role: "Registers and retrieves AgentConfig."
    - name: "AgentExecutorService"
      path: "l9/core/agents/engine.py"
      role: "Runs agent tasks and handles tool calls."
  internal_helpers:  # Internal-only helpers
    - name: "_build_prompt_stack"
      path: "l9/core/agents/engine.py"
      role: "Assemble kernels and memory into a system prompt."

data_and_contracts:
  schemas:  # Data contracts this subsystem owns (Pydantic/etc.)
    - name: "AgentTask"
      path: "l9/core/agents/schemas.py"
      role: "Canonical shape of agent work items."
    - name: "TaskKind"
      path: "l9/core/agents/schemas.py"
      role: "Enum of supported task types (conversation, plan, etc.)."
  invariants:  # Rules that must always hold
    - "AgentTask.agent_id MUST refer to a registered agent."
    - "TaskKind must not be extended without updating executors."

lifecycle:
  startup:  # How this subsystem is wired on process start
    description: "Registry bootstrapped and L config loaded from kernels/manifest."
  shutdown:  # Cleanup behavior
    description: "No explicit cleanup; relies on outer runtime to close resources."

configuration:
  feature_flags:  # Flags that change behavior here
    - "L9_ENABLE_AGENT_TRACING"
  env_vars:  # Environment-specific toggles that affect this subsystem
    - "L9_AGENT_MAX_ITERATIONS"
  config_files:  # Config sources read by this subsystem
    - "L-YAML.yaml"

observability:
  logs:  # Log conventions for this subsystem
    - "agent.* logs cover agent lifecycle and decisions."
  metrics:  # Metrics relevant to this subsystem
    - "agent_task_duration_seconds"
    - "agent_tool_calls_total"

failure_modes:
  common:  # Expected failure patterns
    - "Unknown agent_id passed to registry."
    - "Tool registry missing required tool for agent."
  resilience:  # How the subsystem handles failures
    - "Return structured error packets to caller."
    - "Never crash the process on agent failure."

ai_collaboration:
  safe_to_edit:  # Files AI may modify here
    - "engine.py"
    - "registry.py"
  requires_review:  # Files where edits must be human-reviewed
    - "schemas.py"
  invariants_to_preserve:  # Rules AI must not break
    - "AgentTask schema must remain backward compatible."
    - "Public APIs must keep signatures unless explicitly versioned."
```


***

## Component README template (`l9/core/<component>/README.meta.yaml`)

Use for more granular components like `l9/core/memory/`, `l9/core/tools/`, `l9/core/websocket_orchestrator/`.[^1]

```yaml
location: "l9/core/memory/"  # Directory of this component

type: component_readme  # Component-level README

component:
  name: "Memory Substrate"  # Component name
  purpose: "Provide read/write APIs over L9 memory storage."  # Primary role
  consumers:  # Who uses this component
    - "Agents engine"
    - "Mac Agent and health checks"

public_apis:
  functions:  # Public functions or methods
    - name: "memory_search"
      path: "l9/core/memory/substrateretriever.py"
      signature: "(query, segments) -> list[MemoryHit]"
      role: "Semantic search over configured memory segments."
    - name: "memory_write"
      path: "l9/core/memory/runtime.py"
      signature: "(packet: PacketEnvelope) -> None"
      role: "Persist packet to memory substrate."
  classes:  # Public classes
    - name: "SubstrateServiceProtocol"
      path: "l9/core/memory/schemas.py"
      role: "Abstracts over underlying DB/index implementations."

design:
  patterns:  # Architectural patterns used
    - "Repository-style abstraction for storage."
    - "Segmented memory (governance, project_history, tool_audit)."
  constraints:  # Design constraints
    - "Writes must be idempotent where possible."
    - "Search queries must be bounded in size and cost."

state_and_persistence:
  backends:  # Physical storage used
    - "PostgreSQL for durable packet logs."
    - "Vector index for semantic search."
  guarantees:  # Consistency/durability guarantees
    - "At-least-once write semantics for packet logging."
    - "Eventual consistency between packet log and search index."

performance:
  expectations:  # Performance expectations
    - "Memory search should be <300ms p95 with warm cache."
  hot_paths:  # Critical code paths
    - "search_and_rank_hits in substrateretriever.py"

extension_points:
  how_to_extend:  # How to add new behavior
    - "Add new segment type in Memory.yaml and implement support here."
    - "Add new ranking strategies behind feature flags."
  constraints:  # Rules for extensions
    - "New segments must not bypass governance-audit layers."

testing:
  strategy:  # Overall test approach
    - "Unit tests for query/serialization."
    - "Integration tests with real DB/index in CI."
  commands:  # Commands to run tests focused on this component
    - "pytest l9/core/memory"

ai_collaboration:
  safe_to_edit:  # Files AI may edit
    - "substrateretriever.py"
    - "runtime.py"
  risky_to_edit:  # Files that need extra caution
    - "schemas.py"
  post_edit_checks:  # Checks that must be run after AI edits
    - "pytest l9/core/memory"
    - "Verify Memory.yaml invariants still hold."
```


***

## `docs/architecture.md` template (`docs/architecture.meta.yaml`)

```yaml
location: "docs/architecture.md"  # Final markdown output path

type: doc_architecture  # Architecture overview document

system_context:
  description: "High-level description of L9 OS in its environment."  # What the system is and where it runs
  external_actors:  # Humans and external systems interacting with L9
    - "Igor (CTO / Boss)"
    - "Slack users"
    - "Mac Agent VPS"
    - "MCP servers (GitHub, Notion, etc.)"
  external_systems:  # Other services L9 depends on
    - "Postgres"
    - "Redis"
    - "Caddy reverse proxy"

logical_architecture:
  layers:  # Logical layers in the system
    - name: "API Layer"
      role: "HTTP/WebSocket entrypoints (FastAPI)."
    - name: "Agent Orchestration"
      role: "Agent registry, kernels, executor, and plans."
    - name: "Tools & Integrations"
      role: "Internal tools, Mac Agent, MCP clients."
    - name: "Memory"
      role: "Substrate, segments, and retrieval."
  data_flows:  # Key flows across layers
    - "User request → API → Agent → Tools/Memory → Response."

runtime_view:
  common_flows:  # Typical request/response lifecycles
    - id: "chat_flow"
      name: "Agent chat request"
      steps:
        - "HTTP POST /agent/chat received."
        - "AgentExecutorService instantiated with L config."
        - "Memory hydrated; tools attached."
        - "LLM called with kernels + context; tools invoked as needed."
  async_components:  # Queues/workers involved
    - "TaskQueue for long-running plans."
    - "Mac Agent command queue."

deployment_view:
  topology: "Describe services, containers, and network boundaries."  # Deployment structure
  services:
    - name: "l9-api"
      role: "Main FastAPI server."
    - name: "l9-worker"
      role: "Background worker for plans and Mac tasks."
  infra_dependencies:
    - "Docker / docker-compose"
    - "Caddy reverse proxy on VPS"

data_view:
  main_entities:  # Persistent entities and their relationships
    - "PacketEnvelope"
    - "AgentTask"
    - "ToolCallEvent"
  storage_mapping:  # Where each entity is stored
    - entity: "PacketEnvelope"
      backend: "Postgres + vector index"
    - entity: "ToolCallEvent"
      backend: "Postgres tool_audit segment"

cross_cutting_concerns:
  security:  # Security-related architecture aspects
    notes: "AuthN/AuthZ, tool-governance, approval gates."
  observability:  # Logs/metrics/tracing at a high level
    notes: "Centralized logging; metrics per-agent and per-tool."
  configuration:  # Config and feature flag strategy
    notes: "config.yaml + env vars drive behavior per environment."
```


***

## `docs/ai-collaboration.md` template (`docs/ai-collaboration.meta.yaml`)

```yaml
location: "docs/ai-collaboration.md"  # AI collaboration guide path

type: doc_ai_collaboration  # AI-specific documentation

philosophy:
  goals:  # What AI collaboration should optimize for
    - "Safety and determinism."
    - "Traceable, diff-based changes."
    - "Respect for governance and approval gates."
  anti_goals:  # Behaviors AI must avoid
    - "Unbounded refactors without TODO plans."
    - "Direct edits to security-critical code without approval."

pre_reading:
  required_files:  # Files AI must read before code changes
    - "README.md"
    - "docs/architecture.md"
    - "docs/capabilities.md"
    - "docs/memory-and-tools.md"
  optional_files:  # Helpful but not mandatory sources
    - "L-YAML.yaml"
    - "LMEMORYANDTOOLSMANIFEST.txt"

editing_rules:
  allowed_areas:  # Paths where AI is generally allowed to edit
    - "l9/core/**/*.py"
  review_required_areas:  # Paths that always require human review
    - "l9/docker-compose.yml"
    - "l9/core/auth.py"
    - "l9/private/kernels/**/*.yaml"
  forbidden_areas:  # Paths AI must not modify
    - ".env"
    - "secrets/**"

change_workflow:
  phases:  # Expected phases for AI-driven changes
    - "Phase 0: Research & TODO plan lock."
    - "Phase 1: Baseline confirmation."
    - "Phase 2–4: Implementation, enforcement, validation."
    - "Phase 5–6: Recursive verification and final report."
  artifacts:  # Required outputs per change
    - "TODO plan with file/line/action."
    - "Execution report in docs or l9/reports."
    - "Code diff and updated tests/docs."

validation:
  required_checks:  # Checks that must pass for AI changes
    - "pytest"
    - "ruff"
    - "mypy"
  extra_checks_for_sensitive_changes:  # Additional steps for critical areas
    - "Manual review by Igor."
    - "Staging deployment verification."

examples:
  good_patterns:  # Positive examples
    - "Small, scoped diffs with clear TODO mapping."
    - "Adding tests before changing behavior."
  bad_patterns:  # Things AI must avoid
    - "Editing many unrelated files in a single change."
    - "Removing guards or approval checks."
```


***

## Where to use each template

- **Root README YAML** → `/README.meta.yaml` → generates `/README.md`.
- **Subsystem README YAML** → one per important folder, e.g.:
    - `l9/core/agents/README.meta.yaml`
    - `l9/core/memory/README.meta.yaml`
    - `l9/api/README.meta.yaml`
- **Component README YAML** → for deeper components:
    - `l9/core/tools/README.meta.yaml`
    - `l9/core/websocket_orchestrator/README.meta.yaml`
- **`docs/architecture.meta.yaml`** → generates `docs/architecture.md`.
- **`docs/ai-collaboration.meta.yaml`** → generates `docs/ai-collaboration.md`.[^1]
