# GMP-6 ‚Äî LangGraph Long-Plan DAGs Integrating Memory, MCP, Mac Agent, and GMP (with Igor Approval for GMP/Git)

You are C (Cursor) operating inside the L9 repository.

You are not creating new business workflows.
You are wiring LangGraph DAGs that orchestrate existing tools for long plans.

## üéØ OBJECTIVE (LOCKED)

Introduce LangGraph-based DAGs that:

1. Orchestrate L‚Äôs tools (memory, MCP, Mac Agent, GMP).
2. Encode governance discipline (PLAN ‚Üí EXECUTE ‚Üí HALT).
3. Respect that **GMP runs and git commits require Igor‚Äôs explicit approval**, but allow L to set up pending actions.

## üß± SCOPE (FILES ONLY)

You MAY modify / create:

- New Python modules for LangGraph graphs (e.g., `long_plan_graphs.py`).
- Wiring code that exposes graph executions as tools (e.g., `long_plan.execute`).
- Any necessary glue code to call:
  - Memory helpers.
  - MCP meta-tool.
  - `mac_agent.exec_task`.
  - `gmp_run` (pending-only, aligned with GMP-3).

You MAY NOT:

- Bypass the Igor approval constraint for actual GMP execution or git commit.
- Touch non-`.py` files.

## REQUIRED CHANGES

1Ô∏è‚É£ Define DAG templates

- Create a LangGraph DAG (or several) for long plans, e.g., `execute_long_plan`:
  - Nodes:
    - `hydrate_memory` ‚Üí uses `memory_search` on `governance_meta` + `project_history`. [file:149][file:154][file:156]
    - `gather_context` ‚Üí MCP tools (GitHub for repo state, Notion for docs, etc.). [web:191][web:177]
    - `draft_work` ‚Üí L or a worker agent via existing LLM tool.
    - `prepare_changes` ‚Üí uses `mac_agent.exec_task` and/or `gmp_run` **in pending mode only** (no auto-execution).
    - `final_review` ‚Üí L reviews diffs / results.
  - Edges enforce PLAN ‚Üí EXECUTE ‚Üí HALT.

2Ô∏è‚É£ Igor approval integration

- Ensure DAG nodes that would:
  - Execute GMP.
  - Push git commits or deploy via MCP (GitHub/Vercel).
- Only:
  - Create pending actions (tasks or MCP calls with `requires_igor_approval` flag).
  - Surface a summary for Igor to review, not perform the action directly.

3Ô∏è‚É£ Expose DAG as tools

- Register tools like:
  - `long_plan.execute`
  - `long_plan.simulate`
- Tool behavior:
  - Takes `goal`, `constraints`, `target_apps`.
  - Runs the LangGraph DAG.
  - Logs tool calls and memory writes as per GMP-5.

## FINAL VALIDATION

- A sample long plan (e.g., ‚Äúrefine and document the L9 tool architecture‚Äù) can be executed through the DAG:
  - Memory is read and written.
  - MCP tools are called for GitHub/Notion.
  - Mac Agent and `gmp_run` are used in pending-only fashion where Igor must approve actual execution or commits.
- DAG execution is observable through your tool audit logging.

END PROMPT ‚Äî EXECUTE FULLY, THEN STOP.
