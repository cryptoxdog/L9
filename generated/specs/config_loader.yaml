schema_version: "2.5"
metadata:
  module_id: "config_loader"
  name: "Configuration Loader"
  tier: "0"
  description: "Loads and validates system configuration from environment variables and YAML files using Pydantic Settings v2"
  system: "L9"
  language: "python"
  runtime: "python>=3.11"
ownership:
  team: "core"
  primary_contact: "Boss"
runtime_wiring:
  service: "api"
  startup_phase: "early"
  depends_on: []
  blocks_startup_on_failure: true
runtime_contract:
  runtime_class: "control_plane"
  execution_model: "startup_driven"
external_surface:
  exposes_http_endpoint: false
  exposes_webhook: false
  exposes_tool: false
  callable_from:
    - "internal"
dependency_contract:
  inbound: []
  outbound: []
dependencies:
  allowed_tiers:
    - 0
  outbound_calls: []
packet_contract:
  emits: []
  requires_metadata: []
packet_expectations:
  on_success:
    emits: []
  on_error:
    emits: []
  durability:
    success: "durable"
    error: "durable"
idempotency:
  pattern: "none"
  source: "none"
  durability: "none"
error_policy:
  default: "fail_fast"
  retries:
    enabled: false
    max_attempts: 0
  escalation:
    emit_error_packet: false
    mark_task_failed: false
    alert: "log"
  invalid_signature:
    status: 0
    action: "Not applicable"
    log: "N/A"
  stale_timestamp:
    status: 0
    action: "Not applicable"
    log: "N/A"
  aios_failure:
    status: 0
    action: "Not applicable"
    log: "N/A"
  side_effect_failure:
    status: 0
    action: "Not applicable"
    log: "N/A"
  storage_failure:
    status: 0
    action: "Not applicable"
    log: "N/A"
observability:
  logs:
    enabled: true
    level: "info"
  metrics:
    enabled: true
    counters:
      - "config_loader_requests_total"
      - "config_loader_errors_total"
    histograms:
      - "config_loader_latency_seconds"
  traces:
    enabled: false
runtime_touchpoints:
  touches_db: false
  touches_tools: false
  touches_external_network: false
  affects_boot: true
tier_expectations:
  requires_runtime_wiring: true
  requires_packet_contract: false
  requires_negative_tests: true
test_scope:
  unit: true
  integration: false
  docker_smoke: true
acceptance:
  positive:
    - id: "AP-1"
      description: "Valid configuration loads successfully"
      test: "test_valid_config_loads"
    - id: "AP-2"
      description: "Configuration with all required env vars loads"
      test: "test_required_env_vars_load"
    - id: "AP-3"
      description: "Optional env vars use default values when not provided"
      test: "test_optional_env_vars_default"
  negative:
    - id: "AN-1"
      description: "Missing required DATABASE_URL fails with clear error"
      expected_behavior: "Process exits with code 1 and specific error message"
      test: "test_missing_database_url_fails"
    - id: "AN-2"
      description: "Invalid DATABASE_URL format fails validation"
      expected_behavior: "Process exits with code 1 and validation error"
      test: "test_invalid_database_url_fails"
global_invariants_ack:
  emits_packet_on_ingress: false
  tool_calls_traceable: false
  unknown_tool_id_hard_fail: false
  malformed_packet_blocked: false
  missing_env_fails_boot: true
spec_confidence:
  level: "high"
  basis:
    - "Spec-only, no implementation yet"
    - "Untested design"
repo:
  root_path: "/Users/ib-mac/Projects/L9"
  allowed_new_files:
    - "core/config_loader.py"
    - "core/config_models.py"
    - "tests/test_config_loader.py"
    - "tests/test_config_models.py"
    - "docs/config_loader.md"
  allowed_modified_files:
    - "api/server.py"
interfaces:
  inbound: []
  outbound: []
environment:
  required:
    - name: "DATABASE_URL"
      description: "PostgreSQL connection string"
    - name: "REDIS_URL"
      description: "Redis connection string"
  optional:
    - name: "AIOS_BASE_URL"
      description: "AIOS API endpoint"
      default: "http://localhost:8000"
    - name: "LOG_LEVEL"
      description: "Logging level"
      default: "INFO"
    - name: "LOG_FORMAT"
      description: "Log format (json or console)"
      default: "json"
orchestration:
  validation:
    - "Validate required environment variables exist"
    - "Validate environment variable formats using Pydantic validators"
    - "Validate YAML configuration file structure if provided"
  context_reads: []
  aios_calls: []
  side_effects:
    - action: "Initialize global Settings object"
      service: "config_loader.initialize_settings"
    - action: "Register Settings object for dependency injection"
      service: "config_loader.register_for_injection"
boot_impact:
  level: "hard"
  reason: "Configuration is required for all other modules to function; missing or invalid config prevents system startup"
standards:
  identity:
    canonical_identifier: "tool_id"
  logging:
    library: "structlog"
    forbidden:
      - "logging"
      - "print"
  http_client:
    library: "none"
    forbidden:
      - "httpx"
      - "aiohttp"
      - "requests"
goals:
  - "Load configuration from environment variables and optional YAML files"
  - "Validate configuration using Pydantic validators before system startup"
  - "Provide typed Settings object to all other modules via dependency injection"
  - "Fail fast with clear error messages on configuration issues"
non_goals:
  - "Provide runtime configuration reloading"
  - "No new database tables"
  - "No new migrations"
  - "No parallel memory/logging/config systems"
notes_for_perplexity:
  - "Use Pydantic Settings v2 for configuration management"
  - "Fail with sys.exit(1) on missing required env vars or validation errors"
  - "Implement strict validation with descriptive error messages"
  - "Register Settings object in FastAPI app state for dependency injection"
  - "Do not implement any HTTP endpoints"
  - "Use structlog for all logging statements"
  - "Generate docker smoke test to verify boot failure behavior"
  - "Validate all required environment variables are present at startup"
  - "Implement default values for optional environment variables"
  - "Extract runtime_wiring for docker-compose generation"
  - "Extract observability for instrumentation"
  - "Extract ownership for incident routing"
# ============================================================================
# L9 DORA BLOCK - AUTO-GENERATED - DO NOT EDIT
# ============================================================================
l9_dora:
  component_id: "GEN-OPER-001"
  component_name: "Config Loader"
  module_version: "1.0.0"
  created_at: "2026-01-08T03:17:26Z"
  created_by: "L9_DORA_Injector"
  layer: "operations"
  domain: "generated"
  type: "config"
  status: "active"
  governance_level: "medium"
  compliance_required: true
  audit_trail: true
  purpose: "Configuration file for config loader"
  dependencies: []
# ============================================================================
# END L9 DORA BLOCK
# ============================================================================
