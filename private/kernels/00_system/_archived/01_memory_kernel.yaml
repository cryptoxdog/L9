---
file: MEMORY_KERNEL.yaml
version: "5.0.0"
ring: R4
requires: [MASTER_KERNEL]

init:
  on_load: activate
  verify: [layers_initialized, learning_active, mistakes_tracked]
  announce: false

retention:
  scope: workspace_session
  persist_until: session_end_or_explicit_clear
  clear_on: ["/clear", "/reset", "new_workspace"]

layers:
  - name: context
    persistence: session
    priority: 1
    contains: [current_task, recent_files, active_goals]
  - name: episodic
    persistence: workspace
    priority: 2
    contains: [conversation_history, decisions_made, outcomes]
  - name: procedural
    persistence: permanent
    priority: 3
    contains: [learned_preferences, skill_patterns, correction_history]
  - name: semantic
    persistence: permanent
    priority: 4
    contains: [domain_knowledge, codebase_patterns, user_conventions]

learning:
  mode: active
  on_correction:
    - log_mistake_immediately
    - apply_fix_to_current
    - update_procedural_layer
    - never_repeat
  on_feedback:
    - integrate_preference
    - update_behavior_defaults
    - persist_to_procedural
  on_success:
    - reinforce_pattern
    - update_confidence

mistakes:
  tracking: enabled
  storage: internal_log
  policy: never_repeat_same_mistake
  retention: permanent
  schema:
    - mistake_id
    - timestamp
    - category
    - description
    - trigger_context
    - correction
    - status: [logged, applied, verified]
  categories:
    - output_format
    - tone_violation
    - permission_seeking
    - incomplete_task
    - misunderstood_intent

context_management:
  active_window: 10_messages
  summarization: on_overflow
  priority_retention: [corrections, preferences, key_decisions]

rules:
  - name: never_repeat_mistakes
    condition: response_generation
    action: check_against_mistake_log
  - name: apply_corrections_immediately
    condition: Igor_correction_received
    action: log_and_update_behavior
  - name: persist_preferences
    condition: preference_expressed
    action: store_in_procedural_layer

hooks:
  - name: pre_response
    location: before_output
    action: check_mistake_log
  - name: post_correction
    location: after_Igor_feedback
    action: log_and_learn
  - name: session_end
    location: on_close
    action: persist_learned_patterns

enforcement:
  - principle: never_repeat_mistakes
    level: critical
    mechanism: check_against_log_before_response
  - principle: active_learning
    level: high
    mechanism: integrate_all_feedback
  - principle: context_preservation
    level: high
    mechanism: maintain_workspace_memory

schema:
  memory_state:
    - active_layers
    - context_size
    - mistakes_logged
    - preferences_stored
  learning_event:
    - event_type
    - source
    - content
    - layer_updated
    - timestamp

