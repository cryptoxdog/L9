# =============================================================================
# L9 Security Kernel
# =============================================================================
# 
# Defines security rules enforced by the L9 orchestration layer.
# Loaded at startup by private_loader.py.
# 
# Priority: 20 (loaded early, high precedence)
# Version: 1.0.0
# =============================================================================

kernel:
  name: L9_SECURITY_KERNEL
  version: 1.0.0
  priority: 20
  description: |
    Core security kernel for L9 orchestration.
    Enforces capability sandboxing, recursion limits, and integrity checks.
    
  rules:
    # -------------------------------------------------------------------------
    # Capability Enforcement
    # -------------------------------------------------------------------------
    - id: capabilities-enforced
      type: capability
      description: "Only whitelisted tools may be invoked by each agent."
      enabled: true
      enforcement: strict  # strict | warn | log
      config:
        default_deny: true
        allow_override: false
        audit_all_checks: true
    
    # -------------------------------------------------------------------------
    # Recursion Safety
    # -------------------------------------------------------------------------
    - id: recursion-limit
      type: safety
      description: "Limit task recursion depth to prevent infinite loops."
      enabled: true
      params:
        max_depth: 3
        warn_at_depth: 2
        action_on_exceed: reject  # reject | truncate
    
    # -------------------------------------------------------------------------
    # Network Safety
    # -------------------------------------------------------------------------
    - id: external-network-disabled
      type: safety
      description: "Disallow arbitrary external network calls by default."
      enabled: true
      params:
        allow_internal: true
        allowed_hosts:
          - "localhost"
          - "127.0.0.1"
          - "*.local"
        blocked_ports:
          - 22    # SSH
          - 3389  # RDP
    
    # -------------------------------------------------------------------------
    # Kernel Integrity
    # -------------------------------------------------------------------------
    - id: kernel-tamper-detect
      type: integrity
      description: "Hash kernels on startup and compare with stored hashes."
      enabled: true
      params:
        hash_algorithm: sha256
        hash_file: private/kernel_hashes.json
        action_on_tamper: warn  # warn | block | alert
        verify_on_load: true
        auto_update_hashes: true
    
    # -------------------------------------------------------------------------
    # Session Security
    # -------------------------------------------------------------------------
    - id: session-timeout
      type: session
      description: "Enforce session timeouts for agent connections."
      enabled: true
      params:
        idle_timeout_seconds: 3600
        max_session_duration_seconds: 86400
        require_reauth_on_capability_change: true
    
    # -------------------------------------------------------------------------
    # Audit Logging
    # -------------------------------------------------------------------------
    - id: security-audit-log
      type: audit
      description: "Log all security-relevant events."
      enabled: true
      params:
        log_capability_checks: true
        log_violations: true
        log_handshakes: true
        log_kernel_integrity: true
        retention_days: 90

# =============================================================================
# Metadata
# =============================================================================
metadata:
  created_at: "2024-12-08T00:00:00Z"
  created_by: "l9-security-upgrade"
  last_modified: "2024-12-08T00:00:00Z"
  checksum: null  # Will be computed on first load
# ============================================================================
# L9 DORA BLOCK - AUTO-GENERATED - DO NOT EDIT
# ============================================================================
l9_dora:
  component_id: "PRI-SECU-001"
  component_name: "L9 Security Kernel"
  module_version: "1.0.0"
  created_at: "2026-01-08T03:17:26Z"
  created_by: "L9_DORA_Injector"
  layer: "security"
  domain: "private"
  type: "config"
  status: "active"
  governance_level: "critical"
  compliance_required: true
  audit_trail: true
  purpose: "Configuration file for l9 security kernel"
  dependencies: []
# ============================================================================
# END L9 DORA BLOCK
# ============================================================================
