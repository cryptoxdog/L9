# ============================================================
# CURSOR WIRE-IN INSTRUCTIONS â€” MEMORY v2.0
# ============================================================
#
# ROLE
#   You are Cursor operating inside the L9 repository.
#
# OBJECTIVE
#   Bind memory-yaml2.0.yaml to existing code WITHOUT rewriting logic.
#
# HARD RULES (DO NOT VIOLATE)
#   - DO NOT refactor modules
#   - DO NOT create parallel memory systems
#   - DO NOT regenerate business logic
#   - DO NOT move files
#
# ============================================================

wire_in_steps:

  - step: verify_existing_modules
    action:
      - confirm_file_exists: memory/ingestion.py
      - confirm_file_exists: memory/retrieval.py
      - confirm_file_exists: memory/insight_extraction.py
      - confirm_file_exists: memory/substrate_semantic.py
      - confirm_file_exists: memory/substrate_graph.py
      - confirm_file_exists: memory/state_manager.py

  - step: bind_semantic_layer
    action:
      - map_yaml.semantic.module -> memory/substrate_semantic.py
      - ensure_embedding_calls already exist
      - annotate with comment: "# bound to memory-yaml2.0 semantic layer"

  - step: bind_graph_layer
    action:
      - map_yaml.structural.module -> memory/substrate_graph.py
      - ensure Neo4j writes are idempotent
      - annotate with comment: "# bound to memory-yaml2.0 structural layer"

  - step: bind_ingestion_pipeline
    action:
      - confirm ingestion.py writes to postgres
      - confirm async embedding trigger
      - confirm graph sync hook exists
      - annotate ingestion entrypoint

  - step: bind_retrieval_bundle
    action:
      - confirm retrieval.py assembles:
          - recent messages
          - semantic hits
          - graph context
          - facts
      - expose as MemoryBundle object

  - step: forbid_drift
    action:
      - search_for_duplicate_patterns:
          - second vector store
          - second graph client
          - parallel memory folders
      - if_found: STOP_AND_REPORT

  - step: final_verification
    action:
      - ensure memory behavior unchanged
      - ensure only bindings/comments added
      - report bound_modules list

expected_output:
  - "Memory YAML v2.0 successfully bound"
  - "No logic rewritten"
  - "Persistent agent memory intact"

# ============================================================
# END WIRE-IN
# ============================================================
